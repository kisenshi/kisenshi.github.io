<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Cheese with posts</title>
    <link>http://kisenshi.github.io/tags/module/index.xml</link>
    <description>Recent content on Cheese with posts</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>The content of this site is licensed under a Creative Commons Attribution 4.0 International License</copyright>
    <atom:link href="http://kisenshi.github.io/tags/module/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Game AI Module Project - Portal 2D</title>
      <link>http://kisenshi.github.io/post/2017_02_27_game_ai_module/</link>
      <pubDate>Mon, 27 Feb 2017 00:00:00 +0000</pubDate>
      
      <guid>http://kisenshi.github.io/post/2017_02_27_game_ai_module/</guid>
      <description>

&lt;p&gt;As part of the Game AI module I took at &lt;em&gt;Goldsmiths University&lt;/em&gt; on February 2017 it was needed to design, implement and playtest an AI-based game. There was no technichal constraints or limitations. The idea was making something that could be useful later for my research and, as I need to use the &lt;em&gt;GVGAI Framework&lt;/em&gt;, I opted to use it in order to get familiar with it. &lt;em&gt;Valve&lt;/em&gt;&amp;rsquo;s &lt;em&gt;Portal&lt;/em&gt; series are in the top of my favourite games list (&lt;a href=&#34;http://store.steampowered.com/bundle/234/&#34;&gt;check them out&lt;/a&gt; if you haven&amp;rsquo;t),  so I decided to make my game based on them.&lt;/p&gt;

&lt;h1 id=&#34;architecture&#34;&gt;Architecture&lt;/h1&gt;

&lt;h2 id=&#34;gvgai-framework&#34;&gt;GVGAI Framework&lt;/h2&gt;

&lt;p&gt;The &lt;a href=&#34;https://github.com/EssexUniversityMCTS/gvgai&#34;&gt;GVGAI Framework&lt;/a&gt; it is a JAVA-based open source framework used for the &lt;a href=&#34;http://www.gvgai.net/&#34;&gt;General Video Game AI Competition&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;It supports arcade-style 2D games built in &lt;em&gt;VGDL language&lt;/em&gt;. These (1 or 2 player) games can be easily set up to be played by a human or a controller. Because of the GVGAI competition, the framework is fully documented and there are lot of games an sample controllers available.&lt;/p&gt;

&lt;p&gt;For the assessment, I simply forked the framework in my own repository to easily create a new game and a controller for it.&lt;/p&gt;

&lt;h2 id=&#34;vgdl-language&#34;&gt;VGDL Language&lt;/h2&gt;

&lt;p&gt;The &lt;em&gt;Video Game Definition Language&lt;/em&gt; (VGDL) was initially implemented in python and ported to JAVA to be used in the framework for the competition. To create a game, it is just needed to declare two files:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;em&gt;Game description file&lt;/em&gt;. In this file it is declared the termination rules, objects, their interactions and how they should be mapped when defined in the level description file.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;em&gt;Level description file&lt;/em&gt;. This file should contain a 2D matrix of symbols corresponding to the elements defined in the mapping section of the game description file.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;As a detailed explanation about the language can be found in the framework wiki I will not get into details in here. An easy example, taken from the Framework, are the description files for the game Sokoban. As shown, just a couple of lines of code are enough to create a very simple game, pictured below.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;BasicGame key_handler=Pulse square_size=40
	SpriteSet
        floor &amp;gt; Immovable img=newset/floor2
        hole   &amp;gt; Immovable color=DARKBLUE img=oryx/cspell4
        avatar &amp;gt; MovingAvatar img=oryx/knight1
        box    &amp;gt; Passive img=newset/block1 shrinkfactor=0.8
        wall &amp;gt; Immovable img=oryx/wall3 autotiling=True
    LevelMapping
        0 &amp;gt; floor hole
        1 &amp;gt; floor box
        w &amp;gt; floor wall
        A &amp;gt; floor avatar
        . &amp;gt; floor
    InteractionSet
    	avatar wall &amp;gt; stepBack
    	box avatar  &amp;gt; bounceForward
    	box wall box  &amp;gt; undoAll
    	box hole    &amp;gt; killSprite scoreChange=1
    TerminationSet
    	SpriteCounter stype=box    
    	limit=0 win=True
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;wwwwwwwwwwwww
w........w..w
w...1.......w
w...A.1.w.0ww
www.w1..wwwww
w.......w.0.w
w.1........ww
w..........ww
wwwwwwwwwwwww
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img class=&#34;img-responsive post_img_center&#34; src=&#34;http://kisenshi.github.io/img/posts/game_ai_module/sokoban_example.png&#34; alt=&#34;Sokoban example&#34;&gt;&lt;/p&gt;

&lt;h1 id=&#34;game&#34;&gt;Game&lt;/h1&gt;

&lt;p&gt;The game I created for the assessment is based in &lt;em&gt;Valve&lt;/em&gt;&amp;rsquo;s &lt;em&gt;Portal&lt;/em&gt; where 2 different player have to reach a different goal in order to win:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Human (subject)&lt;/strong&gt;. Their goal is collecting the cake avoiding being killed, either being shot by the other player or steping into the traps allocated around the level. The player is allowed to move up, down, left or rignt and shoot to create Portals in the walls (one orange &amp;amp; one blue). It is possible to teleport between the Portals created in order to reach different areas of the level.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;Turret&lt;/strong&gt;. Its goal is killing the &lt;em&gt;subject&lt;/em&gt; before they collect the cake. The player is allowed to move up, down, left or right and shoot a laser that immediately kills the other player.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Other elements needed to implement the game are:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Floor and walls. Both characters are allowed to walk over the floor but they can&amp;rsquo;t go through walls so these define the shape of the level.&lt;/li&gt;
&lt;li&gt;Trap. The turret character is allowed to walk through this object as it was floor but it is harmful for the human character as it kills them if they step onto it.&lt;/li&gt;
&lt;li&gt;Cake. Items collectable by the human character that triggers their victory if collected.&lt;/li&gt;
&lt;li&gt;Laser shot. Launched by the turret character when the action is selected. It is a missile that moves in the same direction the player is facing to and kills the human character if hitted before a wall is ecnountered.&lt;/li&gt;
&lt;li&gt;Portal shot (blue or orange). Launched by the human character when the action is selected. It is a missile that moves in the same direction as the player is facing and creates a Portal when hitting a wall.&lt;/li&gt;
&lt;li&gt;Portal (blue or orange). If two portals are created in the level (one orange and one blue), they allow the human character to teleport between them.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Below it has been included a screenshot of the game created containing all the elements described: The turret has shot a laser trying to reach the human player, who has moved down to avoid it. The human player has created two Portals to be able to move to the area below (from the blue Portal to the orange Portal) without stepping into the traps in order to be closer to the cake.&lt;/p&gt;

&lt;p&gt;&lt;img class=&#34;img-responsive post_img_center&#34; src=&#34;http://kisenshi.github.io/img/posts/game_ai_module/game_screenshot.jpg&#34; alt=&#34;Game screenshot&#34;&gt;&lt;/p&gt;

&lt;h2 id=&#34;ai-behaviour&#34;&gt;AI behaviour&lt;/h2&gt;

&lt;p&gt;As part of the assessment, it was needed to include some kind of AI in the game. It was decided to develop a controller for the turret, focused on finding and killing the human. An overview of what it was implemented for the AI behaviour is:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Actions planning.&lt;/li&gt;
&lt;li&gt;Targetting/Searching states.&lt;/li&gt;
&lt;li&gt;Pathfinding: A*&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;pathfinding&#34;&gt;Pathfinding&lt;/h3&gt;

&lt;p&gt;&lt;img class=&#34;img-responsive post_img_right&#34; src=&#34;http://kisenshi.github.io/img/posts/game_ai_module/navigation_matrix.jpg&#34; alt=&#34;Navigation matrix&#34;&gt;&lt;/p&gt;

&lt;p&gt;To allow an efficient way to move around the map, it was decided to use the &lt;strong&gt;A* algorithm&lt;/strong&gt;, considering every move with cost 1 and having the distance between the Start and Goal positions as the heuristic.&lt;/p&gt;

&lt;p&gt;In order to implement the algorithm, it was needed to identify the navigation matrix (valid positions for the turret), which would be used to identify the valid neighbours on-the-fly when the algorithm was run. For the level created, the navigation matrix is marked in orange-colour in the image on the right.&lt;/p&gt;

&lt;p&gt;Once the A* algorithm returned the list of positions that should be followed to reach the desired position, it was needed to convert these into valid actions to be followed by the turret. In the example below, as the turret is orientated to the right and the desired movement implies going down, it is needed to add an &amp;ldquo;extra&amp;rdquo; action to turn and face the desired orientation:&lt;/p&gt;

&lt;p&gt;&lt;img class=&#34;img-responsive post_img_center&#34; src=&#34;http://kisenshi.github.io/img/posts/game_ai_module/positions_to_actions.png&#34; alt=&#34;Positions to actions&#34;&gt;&lt;/p&gt;

&lt;h3 id=&#34;states&#34;&gt;States&lt;/h3&gt;

&lt;h4 id=&#34;targetting&#34;&gt;Targetting&lt;/h4&gt;

&lt;p&gt;If the human is in-sight, the logic is adapted to enter this state and plan the list of actions to kill them. If the turret has a list of actions already planned but the previous state was not &lt;em&gt;targetting&lt;/em&gt; the previous plan of actions is unrelevant as this is the most important status.&lt;/p&gt;

&lt;h4 id=&#34;searching&#34;&gt;Searching&lt;/h4&gt;

&lt;p&gt;When the human is not in-sight, it is needed to find the best spot to be able to target them. The pathfinding algorithm is called and the actions planned to reach the desired position. If, while these list of actions are being carried out, there is no change of status, the turret would keep following them.&lt;/p&gt;

&lt;p&gt;&lt;img class=&#34;img-responsive post_img_left&#34; src=&#34;http://kisenshi.github.io/img/posts/game_ai_module/areas.jpg&#34; alt=&#34;Areas&#34;&gt;
It was needed to take into cosideration the existance of different areas in the level, which are those limited by walls and traps where the human is forced to use a Portal to move between them.&lt;/p&gt;

&lt;p&gt;It was included an interruption in the seacrhing plan for the special case of the human not being the same area as they were when the pathfinding algorithm ran. If it is detected that the human has changed from an area to another, a new search is run to update the movement-actions plan in order to get closer to the player.
&lt;p/&gt;&lt;br/&gt;&lt;/p&gt;

&lt;h3 id=&#34;logic-implementation&#34;&gt;Logic implementation&lt;/h3&gt;

&lt;h4 id=&#34;checking-if-human-in-sight&#34;&gt;Checking if human in-sight&lt;/h4&gt;

&lt;p&gt;To check if the human is in sight, the visible spots in-line with the current position of the character are identified (marked in blue colour in the image below).&lt;/p&gt;

&lt;p&gt;Once these spots are identified, it is checked if the agent current position corresponds with one of those or not.&lt;/p&gt;

&lt;p&gt;&lt;img class=&#34;img-responsive post_img_center&#34; src=&#34;http://kisenshi.github.io/img/posts/game_ai_module/human_in_sight_check.jpg&#34; alt=&#34;Human-in-sight checking&#34;&gt;&lt;/p&gt;

&lt;h4 id=&#34;targetting-the-human&#34;&gt;Targetting the human&lt;/h4&gt;

&lt;p&gt;When the human is in sight, the agent should shoot in the correct direction. In order to achieve this, it should change its orientation if it is not facing the human and shoot once the orientation is the correct one.&lt;/p&gt;

&lt;p&gt;&lt;img class=&#34;img-responsive post_img_center&#34; src=&#34;http://kisenshi.github.io/img/posts/game_ai_module/targetting.jpg&#34; alt=&#34;Turret targetting the human&#34;&gt;&lt;/p&gt;

&lt;h4 id=&#34;finding-the-best-spot-to-move-to&#34;&gt;Finding the best spot to move to&lt;/h4&gt;

&lt;p&gt;The best spot of the agent is the closest from where the human is in-sight at the moment. The spots previously identified are used, taking the one of those closest to the turret as goal for the pathfinding algorithm.&lt;/p&gt;

&lt;p&gt;&lt;img class=&#34;img-responsive post_img_center&#34; src=&#34;http://kisenshi.github.io/img/posts/game_ai_module/best_spot.jpg&#34; alt=&#34;Identifying the best spot&#34;&gt;&lt;/p&gt;

&lt;h4 id=&#34;dumbing-the-ai&#34;&gt;&amp;ldquo;Dumbing&amp;rdquo; the AI&lt;/h4&gt;

&lt;p&gt;When the AI was implemented and the game was tested, most of the feedback received was that the AI was too quick and it was &lt;del&gt;impossible&lt;/del&gt; too difficult to win the game. Because of this, it was decided to add some &lt;em&gt;doNothing&lt;/em&gt; actions when planning the actions to carry out. As a result, even when the logic is the same, it looks like the agent is slower and the player is given a chance to reach the cake before being killed by it.&lt;/p&gt;

&lt;h2 id=&#34;gameplay-video&#34;&gt;Gameplay video&lt;/h2&gt;

&lt;p&gt;Below it is included a gameplay for a fully working game, where the turret (Player 1) is controlled automatically by the implemented AI and the human character (player 0) is controlled by a person:&lt;/p&gt;

&lt;p class=&#34;text-center&#34;&gt;
    &lt;div class=&#34;video-container&#34;&gt;
        &lt;iframe src=&#34;https://www.youtube.com/embed/kYGupL5YHAk&#34; frameborder=&#34;0&#34; allowfullscreen&gt;&lt;/iframe&gt;
    &lt;/div&gt;
&lt;/p&gt;

&lt;h2 id=&#34;the-code&#34;&gt;The code&lt;/h2&gt;

&lt;p&gt;As mentioned before, the framework was forked &lt;a href=&#34;https://github.com/kisenshi/gvgai-gameAI-project&#34;&gt;into my own repository&lt;/a&gt;, where I created the game and implemented the AI logic. Some bugs were found during the playtesting session (they have been fixed) so the last up-to-date version can be found in the &lt;a href=&#34;https://github.com/kisenshi/gvgai-gameAI-project/tree/Portal2D-improvements-and-fixes&#34;&gt;&lt;em&gt;Portal2D-improvements-and-fixes&lt;/em&gt; branch&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&#34;running-the-game&#34;&gt;Running the game&lt;/h3&gt;

&lt;p&gt;The files created for the game can be found at:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;em&gt;src/ModuleGame&lt;/em&gt; Main that runs the game.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;aimodule/cake.txt&lt;/em&gt; Game description file.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;aimodule/cake_lvl0.txt&lt;/em&gt; Level description file.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;src/controllers/aimodule/KillSubject/Agent.java&lt;/em&gt; Code of the controller for the turret.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;To run the game, it is suggested to follow the &lt;a href=&#34;https://github.com/EssexUniversityMCTS/gvgai/wiki/GVG-Framework&#34;&gt;instructions provided&lt;/a&gt; in the framework wiki.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Thank you for reading, I hope you enjoy the game!
And don&amp;rsquo;t forget to give &lt;em&gt;Valve&lt;/em&gt;&amp;rsquo;s &lt;em&gt;Portal&lt;/em&gt; games a try because they are really good!! Just bear in mind that&amp;hellip;&lt;/p&gt;

&lt;h2 class=&#34;text-center&#34;&gt;THE CAKE IS A LIE&lt;/h2&gt;
</description>
    </item>
    
  </channel>
</rss>